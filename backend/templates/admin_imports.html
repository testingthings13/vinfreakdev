{% extends "_base.html" %}
{% block content %}
<h1>Import Jobs</h1>
<form class="form" method="post" action="/admin/imports/run">
  <label>Source
    <input name="source" placeholder="carsandbids / json / csv">
  </label>
  <button type="submit">Queue Import</button>
</form>

<table class="table">
  <thead><tr>
    <th>ID</th><th>Source</th><th>Status</th><th>Cars</th><th>Started</th><th>Finished</th><th>Errors</th><th>Actions</th>
  </tr></thead>
  <tbody>
  {% for j in jobs %}
    <tr>
      <td><a href="/admin/imports/{{ j.id }}">{{ j.id }}</a></td>
      <td>{{ j.source }}</td>
      <td>{{ j.status }}</td>
      <td>{{ j.car_count }}</td>
      <td>{{ j.started_at }}</td>
      <td>{{ j.finished_at }}</td>
      <td>{{ (j.errors[:80] ~ 'â€¦') if j.errors and j.errors|length>80 else (j.errors or '') }}</td>
      <td>
        <a href="/admin/imports/{{ j.id }}">View</a>
        {% if j.status in ['queued','running'] and (j.cancellable is not defined or j.cancellable) %}
        <form method="post" action="/admin/imports/{{ j.id }}/cancel" style="display:inline">
          <input type="hidden" name="csrf" value="{{ csrf }}">
          <button type="submit">Cancel</button>
        </form>
        {% endif %}
        <form method="post" action="/admin/imports/{{ j.id }}/delete" style="display:inline">
          <input type="hidden" name="csrf" value="{{ csrf }}">
          <button type="submit">Delete</button>
        </form>
      </td>
    </tr>
  {% endfor %}
  </tbody>
</table>
{% endblock %}
